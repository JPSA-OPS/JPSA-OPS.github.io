<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>A's Fighting Game — Prototype (Guilty Gear style)</title>
  <meta name="description" content="Playable fighting game prototype (Phaser 3) with a Guilty-Gear-inspired menu UI. Drop your music into /assets/music/theme.mp3" />
  <style>
    /* Guilty-Gear-ish dramatic UI: dark, orange accents, strong borders */
    :root{--bg:#05060a;--panel:#0c0f16;--accent:#ff5c7a;--accent2:#ff9a45;--muted:#9fb3cf;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;color:#eaf4ff;background:linear-gradient(180deg,#03040a 0%,#071227 60%)}
    #game-container{width:100%;height:100vh;display:flex;align-items:center;justify-content:center}

    /* Menu UI */
    .ui-layer{position:absolute;inset:0;pointer-events:none}
    .menu{width:980px;max-width:95%;height:640px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;border:2px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(2,6,23,0.8);display:flex;overflow:hidden;pointer-events:auto}
    .menu-left{width:48%;background:linear-gradient(180deg,#0b1220 0%,#071226 100%);padding:28px 22px;color:#fff;border-right:2px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;justify-content:space-between}
    .menu-right{flex:1;padding:20px;background:linear-gradient(180deg,#07102a, #071227);display:flex;flex-direction:column;justify-content:space-between}

    .logo{font-size:28px;font-weight:800;letter-spacing:1px;color:var(--accent);text-shadow:0 6px 20px rgba(255,92,122,0.12)}
    .slogan{color:var(--muted);font-size:13px;margin-top:6px}

    .menu-buttons{margin-top:18px;display:flex;flex-direction:column;gap:12px}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:10px;padding:12px 16px;font-weight:800;color:#071226;border:none;cursor:pointer;outline:none;box-shadow:0 10px 30px rgba(255,90,120,0.12);transform-origin:left center}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);box-shadow:none}
    .btn:hover{transform:translateX(6px)}

    .credits{font-size:12px;color:var(--muted)}

    /* Character select small cards */
    .roster{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
    .char-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;align-items:center}
    .mini-avatar{width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#ff8aa1,#7ad7ff);display:flex;align-items:center;justify-content:center;font-weight:800}
    .char-meta{font-size:13px}

    /* footer for hints */
    .hint{font-size:13px;color:var(--muted);margin-top:8px}

    /* Game overlay (health bars, round UI) */
    .game-ui{position:absolute;left:50%;transform:translateX(-50%);top:12px;width:980px;max-width:95%;pointer-events:none}
    .hud{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:linear-gradient(90deg,rgba(0,0,0,0.35),rgba(0,0,0,0.12));border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
    .health{width:420px;height:18px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,#fff 0%,var(--accent) 100%);width:100%}
    .name{font-weight:800;color:#fff}

    /* Small responsive */
    @media(max-width:780px){
      .menu{height:84vh;flex-direction:column}
      .menu-left{width:100%;border-right:0}
      .game-ui{left:8px;transform:none;width:calc(100% - 16px)}
    }
  </style>
</head>
<body>
  <div id="game-container"></div>

  <!-- UI layer sits on top of canvas for menu and HUD -->
  <div class="ui-layer">
    <div id="menuWrap" style="display:flex;align-items:center;justify-content:center;height:100vh">
      <div class="menu" id="menu">
        <div class="menu-left">
          <div>
            <div class="logo">A's Fighting Game</div>
            <div class="slogan">Prototype — Guilty Gear inspired menu</div>

            <div class="menu-buttons" id="mainButtons">
              <button class="btn" id="btnPlay">PLAY</button>
              <button class="btn" id="btnTraining">TRAINING</button>
              <button class="btn" id="btnRoster">ROSTER</button>
              <button class="btn ghost" id="btnOptions">OPTIONS</button>
              <button class="btn ghost" id="btnCredits">CREDITS</button>
            </div>

            <div class="hint">Use arrows to navigate inside the game. J = Light, K = Heavy. Special: ↓→ + J</div>

            <div class="roster" style="margin-top:18px" id="menuRoster">
              <!-- some roster previews populated by JS -->
            </div>
          </div>
          <div class="credits">Ideas & roster from uploaded PDF: <a href="/mnt/data/Ideas de JPSA (1).pdf" target="_blank" style="color:var(--accent)">Ideas de JPSA (1).pdf</a></div>
        </div>

        <div class="menu-right">
          <div style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="color:var(--muted)">Mode</div>
              <div style="color:var(--muted)">v0.9 — Prototype</div>
            </div>
            <div style="height:12px;border-radius:6px;background:rgba(255,255,255,0.02);margin-top:6px"></div>

            <div style="margin-top:18px;color:var(--muted)">
              <strong style="color:var(--accent)">PLAY</strong> launches a quick match vs CPU (single round). <br>
              <strong style="color:var(--accent)">TRAINING</strong> opens a special sandbox to test moves.
            </div>

            <div style="margin-top:12px;display:flex;gap:8px">
              <div style="flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)">
                <div style="color:var(--muted);font-size:13px">Character Select</div>
                <div id="selectedChar" style="margin-top:8px;color:#fff;font-weight:800">Lucas (default)</div>
              </div>
              <div style="width:180px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)">
                <div style="color:var(--muted);font-size:13px">Stage</div>
                <div id="selectedStage" style="margin-top:8px;color:#fff;font-weight:800">Abasto</div>
              </div>
            </div>

            <div style="margin-top:16px;color:var(--muted);font-size:13px">
              Music: Drop your track at <code>/assets/music/theme.mp3</code> in the repo to be auto-loaded. (Supported: mp3, ogg)
            </div>

          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;align-items:center">
            <button class="btn ghost" id="btnImport">Import Roster</button>
            <button class="btn" id="btnStart">START</button>
          </div>
        </div>
      </div>
    </div>

    <!-- HUD that shows during gameplay -->
    <div class="game-ui" id="hud" style="display:none">
      <div class="hud" style="backdrop-filter:blur(6px);">
        <div style="display:flex;gap:12px;align-items:center">
          <div style="text-align:left">
            <div class="name" id="p1Name">Lucas</div>
            <div class="health" id="p1Health"><div class="bar" id="p1Bar" style="width:100%"></div></div>
          </div>
        </div>
        <div style="text-align:center;color:var(--muted)">ROUND 1</div>
        <div style="display:flex;gap:12px;align-items:center">
          <div style="text-align:right">
            <div class="name" id="p2Name">CPU</div>
            <div class="health" id="p2Health"><div class="bar" id="p2Bar" style="width:100%"></div></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Phaser and game code -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <script>
    // Basic in-browser prototype fighting game using Phaser 3
    // Style A: Guilty Gear inspired menu visuals (implemented via DOM + CSS). Game canvas uses pixel + vector primitives.

    // CONFIG
    const GAME_WIDTH = 980;
    const GAME_HEIGHT = 540;

    // Simple roster (taken from the PDF). We'll map characters to simple colored rectangles / stats.
    const ROSTER = [
      {id:'lucas', name:'Lucas', color:0xff8aa1, hp:100, archetype:'Zonal'},
      {id:'sebas', name:'Sebas', color:0xffb26b, hp:140, archetype:'Grappler'},
      {id:'lisi', name:'Lisi', color:0x7ad7ff, hp:90, archetype:'Rush'},
      {id:'darta', name:'Darta', color:0xb45cff, hp:110, archetype:'Shoto'}
    ];

    // Sound paths (user will add actual music at /assets/music/theme.mp3)
    const MUSIC_PATH = 'assets/music/theme.mp3';
    const SFX = {
      hit:'assets/sfx/hit.wav',
      select:'assets/sfx/select.wav',
      start:'assets/sfx/start.wav'
    };

    // Game State managed partially by DOM buttons
    let selectedChar = ROSTER[0];
    let selectedStage = 'Abasto';

    // DOM wiring
    document.getElementById('selectedChar').textContent = selectedChar.name;
    document.getElementById('selectedStage').textContent = selectedStage;

    const rosterWrap = document.getElementById('menuRoster');
    ROSTER.forEach(r=>{
      const el = document.createElement('div'); el.className='char-card';
      el.innerHTML = `<div class="mini-avatar" style="background:linear-gradient(135deg, #fff 0%, transparent), linear-gradient(135deg, ${toHexCss(r.color)}, #222)">${r.name.charAt(0)}</div><div class="char-meta"><strong>${r.name}</strong><div style="color:var(--muted);font-size:12px">${r.archetype}</div></div>`;
      el.addEventListener('click',()=>{ selectedChar = r; document.getElementById('selectedChar').textContent = r.name; playSFX('select'); });
      rosterWrap.appendChild(el);
    });

    document.getElementById('btnPlay').addEventListener('click', ()=> launchQuickMatch());
    document.getElementById('btnStart').addEventListener('click', ()=> launchQuickMatch());
    document.getElementById('btnTraining').addEventListener('click', ()=> launchTraining());
    document.getElementById('btnRoster').addEventListener('click', ()=> alert('Roster panel is the left preview.\nYou can import full JSON via the Import button.'));
    document.getElementById('btnImport').addEventListener('click', ()=> importRoster());
    document.getElementById('btnCredits').addEventListener('click', ()=> alert('Prototype by the user (ideas from uploaded PDF).'));

    // small sfx loader (silently ignore missing files)
    const audioCtx = {music:null, sfx:{}};
    function loadAudio(scene){
      // try to load music via XHR and decode; Phaser will also try via its loader on scene create
      // We'll prepare a short audio element for music so user-provided file plays if present in site root
      const music = document.createElement('audio');
      music.src = MUSIC_PATH;
      music.loop = true; music.preload='auto';
      music.volume = 0.7;
      music.addEventListener('error', ()=>{/* no-op if missing */});
      audioCtx.music = music;

      // SFX placeholders (we will create beep if missing)
      Object.keys(SFX).forEach(k=>{
        const a = document.createElement('audio'); a.src = SFX[k]; a.preload='auto'; a.addEventListener('error', ()=>{});
        audioCtx.sfx[k] = a;
      });
    }

    function playMusic(){ if(audioCtx.music && audioCtx.music.play) audioCtx.music.play().catch(()=>{}); }
    function stopMusic(){ if(audioCtx.music) audioCtx.music.pause(); audioCtx.music.currentTime = 0; }
    function playSFX(name){ const a = audioCtx.sfx[name]; if(a && a.play) a.play().catch(()=>{}); else console.log('SFX',name,'not found'); }

    // Phaser Scenes
    class BootScene extends Phaser.Scene{
      constructor(){ super('BootScene'); }
      preload(){
        // small graphics (we'll use Phaser to generate backgrounds)
        this.load.image('bgTiles', ''); // intentionally empty — not required
      }
      create(){
        loadAudio(this);
        this.scene.start('MenuScene');
      }
    }

    class MenuScene extends Phaser.Scene{
      constructor(){ super('MenuScene'); }
      create(){
        // Animated background gradient using graphics
        this.bg = this.add.graphics();
        this.t = 0;
        this.time.addEvent({delay:40,loop:true,callback:()=>{ this.t+=0.01; this.drawBG(); }});

        // tiny instruction: clicking the canvas also starts
        this.input.on('pointerdown', ()=>{
          // quick flash
          this.cameras.main.flash(150,255,160,160);
        });

        // show menu UI (DOM) is already present; we just keep canvas as background
        this.scene.stop(); // pause phaser rendering for menu to reduce CPU — we'll resume on play
      }
      drawBG(){
        const g = this.bg; g.clear();
        const w = this.sys.game.config.width; const h = this.sys.game.config.height;
        // moving radial
        const r = Math.abs(Math.sin(this.t*0.6))*260 + 200;
        const cx = w*0.5 + Math.cos(this.t*0.8)*80; const cy = h*0.4 + Math.sin(this.t*0.6)*30;
        const grd = g.createRadialGradient(cx,cy,0,cx,cy,r);
        // manual gradient fill using fillStyle + alpha rectangles
        g.fillStyle(0x071227,1); g.fillRect(0,0,w,h);
        g.fillStyle(0xff5c7a,0.06); g.fillCircle(cx,cy,r);
        g.fillStyle(0xff9a45,0.04); g.fillCircle(cx+140,cy+60,r*0.6);
      }
    }

    class FightScene extends Phaser.Scene{
      constructor(){ super('FightScene'); }
      preload(){
        // no external assets required; will draw shapes
      }
      create(){
        // reveal HUD
        document.getElementById('menuWrap').style.display = 'none';
        document.getElementById('hud').style.display = 'block';
        playMusic();

        const w = this.sys.game.config.width; const h = this.sys.game.config.height;

        // stage background simple
        this.add.rectangle(w/2,h/2,w,h,'0x071226');
        // ground
        this.add.rectangle(w/2,h-60,w,120,0x0f1724).setDepth(1);

        // players
        this.p1 = new Player(this, 220, h-160, selectedChar || ROSTER[0], false);
        this.p2 = new Player(this, 760, h-160, ROSTER[1], true);

        // camera
        this.cameras.main.setBackgroundColor('#071227');

        // collision / bounds
        this.physics.world.setBounds(0,0,w,h);

        // physics collider placeholder
        this.p1.sprite.setCollideWorldBounds(true); this.p2.sprite.setCollideWorldBounds(true);

        // input keys
        this.cursors = this.input.keyboard.createCursorKeys();
        this.keyJ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.J);
        this.keyK = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.K);

        // UI linking for health
        this.updateHealthBars();

        // round state
        this.winner = null;
      }
      update(time, dt){
        if(!this.p1 || !this.p2) return;
        this.p1.update(this.cursors, this.keyJ, this.keyK, this.p2);
        // simple CPU for p2
        this.p2.aiUpdate(this.p1);

        // check collisions simple: if attack active and overlaps
        if(this.p1.isAttacking && Phaser.Geom.Intersects.RectangleToRectangle(this.p1.attackBox.getBounds(), this.p2.sprite.getBounds())){
          this.p2.takeHit(this.p1.attackPower);
          this.p1.onHitLanded();
          playSFX('hit');
        }
        if(this.p2.isAttacking && Phaser.Geom.Intersects.RectangleToRectangle(this.p2.attackBox.getBounds(), this.p1.sprite.getBounds())){
          this.p1.takeHit(this.p2.attackPower);
          this.p2.onHitLanded();
          playSFX('hit');
        }

        this.updateHealthBars();
        if(!this.winner){
          if(this.p1.hp <= 0){ this.winner = 'p2'; this.onKO(); }
          else if(this.p2.hp <= 0){ this.winner = 'p1'; this.onKO(); }
        }
      }
      updateHealthBars(){
        const p1Pct = Phaser.Math.Clamp(this.p1.hp/this.p1.maxHp*100, 0, 100);
        const p2Pct = Phaser.Math.Clamp(this.p2.hp/this.p2.maxHp*100, 0, 100);
        document.getElementById('p1Bar').style.width = p1Pct + '%';
        document.getElementById('p2Bar').style.width = p2Pct + '%';
        document.getElementById('p1Name').textContent = this.p1.name;
        document.getElementById('p2Name').textContent = this.p2.name + ' (CPU)';
      }
      onKO(){
        playSFX('start');
        stopMusic();
        const msg = this.winner === 'p1' ? `${this.p1.name} WINS!` : `${this.p2.name} WINS!`;
        const that = this;
        const t = this.add.text(this.sys.game.config.width/2, 120, msg, {fontSize:'40px',fontFamily:'Arial',color:'#fff'}).setOrigin(0.5);
        t.setShadow(0,6,'#ff5c7a',12);
        this.time.delayedCall(2000, ()=>{
          document.getElementById('menuWrap').style.display = 'flex';
          document.getElementById('hud').style.display = 'none';
          this.scene.start('MenuScene');
          stopMusic();
        });
      }
    }

    class Player{
      constructor(scene,x,y, data, flip){
        this.scene = scene; this.x=x; this.y=y; this.name = data.name; this.maxHp = data.hp; this.hp = data.hp; this.color = data.color; this.flip = flip;
        this.sprite = scene.add.rectangle(x,y,64,112,data.color).setOrigin(0.5,1);
        scene.physics.add.existing(this.sprite); this.sprite.body.setSize(40,100).setOffset(12,12);
        this.speed = 220; this.jumpSpeed = -420; this.isAttacking=false; this.attackPower=8; this.attackBox = scene.add.rectangle(x,y-44,48,28,0xffffff,0.0);
        scene.physics.add.existing(this.attackBox); this.attackBox.body.allowGravity=false; this.attackBox.visible=false;
        this.attackTimer = 0; this.grounded = true;
        // little name text
        this.label = scene.add.text(x, y-140, this.name, {fontSize:'14px',fontFamily:'Arial',color:'#fff'}).setOrigin(0.5);
      }
      update(cursors, keyJ, keyK, enemy){
        const body = this.sprite.body;
        // left/right
        body.velocity.x = 0;
        if(cursors.left.isDown){ body.velocity.x = -this.speed; }
        else if(cursors.right.isDown){ body.velocity.x = this.speed; }

        // jump
        if(Phaser.Input.Keyboard.JustDown(cursors.up) && body.onFloor()){
          body.velocity.y = this.jumpSpeed; this.scene.sound && this.scene.sound.play && this.scene.sound.play('jump');
        }

        // attack J
        if(Phaser.Input.Keyboard.JustDown(keyJ)){
          this.doAttack(1);
        }
        // heavy K
        if(Phaser.Input.Keyboard.JustDown(keyK)){
          this.doAttack(2);
        }

        // update attack box position
        const dir = (enemy.sprite.x > this.sprite.x) ? 1 : -1;
        this.attackBox.x = this.sprite.x + 34*dir;
        this.attackBox.y = this.sprite.y - 44;
        this.label.x = this.sprite.x; this.label.y = this.sprite.y - 140;

        // attack timer
        if(this.attackTimer>0){ this.attackTimer -= this.scene.game.loop.delta; if(this.attackTimer<=0){ this.isAttacking=false; } }
      }
      doAttack(powerType){
        this.isAttacking = true; this.attackPower = powerType===1?8:18; this.attackTimer = 300;
        // small flash
        this.attackBox.fillAlpha = 0.25; const that=this; this.scene.tweens.add({targets:this.attackBox,alpha:0,duration:200});
      }
      onHitLanded(){ this.isAttacking=false; this.attackTimer=0; }
      takeHit(dmg){ this.hp -= dmg; if(this.hp<0) this.hp=0; }
      aiUpdate(player){
        // naive CPU: move towards player and occasionally attack
        const body = this.sprite.body; const px = player.sprite.x;
        if(Math.abs(px - this.sprite.x) > 120){
          body.velocity.x = (px < this.sprite.x) ? -80 : 80;
        } else { body.velocity.x = 0; if(Phaser.Math.Between(0,1000) < 18){ this.doAttack(Phaser.Math.Between(1,2)); } }

        // update attack box
        this.attackBox.x = this.sprite.x + (player.sprite.x > this.sprite.x ? 34 : -34);
        this.attackBox.y = this.sprite.y - 44;
        if(this.attackTimer>0){ this.attackTimer -= this.scene.game.loop.delta; if(this.attackTimer<=0) this.isAttacking=false; }
        this.label.x = this.sprite.x; this.label.y = this.sprite.y - 140;
      }
    }

    // boot the Phaser game
    const config = {
      type: Phaser.AUTO,
      parent: 'game-container',
      width: GAME_WIDTH,
      height: GAME_HEIGHT,
      physics: { default: 'arcade', arcade: { gravity: { y: 1000 }, debug:false } },
      scene: [BootScene, MenuScene, FightScene]
    };

    const game = new Phaser.Game(config);

    // helper functions
    function toHexCss(n){ return '#' + ('000000' + n.toString(16)).slice(-6); }

    function launchQuickMatch(){
      // start or resume phaser scene
      document.getElementById('menuWrap').style.display = 'none';
      game.scene.start('FightScene');
      // ensure music plays if present
      playMusic();
    }

    function launchTraining(){
      alert('Training mode — simplified for prototype. Starting quick match in training rules.');
      launchQuickMatch();
    }

    function importRoster(){
      // let user drop a JSON into prompt (basic supporting function)
      const json = prompt('Paste roster JSON here (or leave blank for default)');
      if(!json) return;
      try{
        const data = JSON.parse(json);
        if(data.characters){
          // override ROSTER
          while(ROSTER.length) ROSTER.pop();
          Object.values(data.characters).forEach(c=>ROSTER.push({id:c.id||c.name,name:c.name||c.id,color:c.color||0xff8aa1,hp:c.hp||100,archetype:c.archetype||''}));
          alert('Roster imported — refresh to apply visuals');
        } else alert('Invalid format: missing characters');
      }catch(e){ alert('JSON parse error: '+e.message); }
    }

    // expose some helpers for debugging
    window.AFG = { game, ROSTER, launchQuickMatch };

  </script>

  <!-- Deployment notes -->
  <!--
    How to deploy to GitHub Pages:
    1) Create a new GitHub repo, add this index.html at root.
    2) Add folder assets/ with subfolders music/ (put your theme.mp3 at assets/music/theme.mp3) and sfx/ if desired.
    3) Push to main branch and enable GitHub Pages (Settings -> Pages -> Deploy from branch: main / root).
    4) Open the published URL. Music will auto-play when a match starts if file exists.

    Files to add for better experience (optional):
    - assets/music/theme.mp3  (your music)
    - assets/sfx/hit.wav
    - assets/sfx/select.wav
    - assets/sfx/start.wav

    Note: Browsers may block autoplay of audio until the user interacts with the page. The UI's Start button triggers audio playback.

    The uploaded PDF used as reference is linked inside the menu, path: /mnt/data/Ideas de JPSA (1).pdf
  -->
</body>
</html>
